name: LaLiga Data Pipeline & Training

# A. Trigger: Cron Schedule
# Ejecutar Martes y Viernes a las 8:00 AM UTC
on:
  schedule:
    - cron: '0 8 * * 2,5'
  # Permite ejecución manual desde GitHub para pruebas
  workflow_dispatch:

jobs:
  build-and-update:
    runs-on: ubuntu-latest # Setup: Ubuntu environment

    steps:
      # 1. Check out del repositorio
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Configurar Python 3.9
      - name: Set up Python 3.9
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. Instalar Chrome y Chromedriver (Necesario para Selenium Headless)
      - name: Install Chrome dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable
          sudo apt-get install -y xvfb

      # 4. Instalar librerías Python
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

     # 5. Ejecutar Scrapers (Arquitectura Híbrida)
      
      # 5.1 Historial (Flashscore - Selenium)
      - name: Run Scraper (History - Flashscore)
        run: python src/scraper.py
        
      # 5.2 Calendario (API - Requests)
      - name: Run API Client (Fixtures - Football-Data)
        run: python src/api_client.py

     # 6. Procesar Datos
      - name: Run Feature Engineering
        run: python src/feature_eng.py

      # 7. Entrenar
      - name: Train Models
        run: python src/models.py

     # 8. Guardar
      - name: Commit and Push changes
        run: |
          git config --global user.name "LaLiga AI Bot"
          git config --global user.email "bot@laliga-ai.com"
          git add data/
          git commit -m "Auto-update: Match results, fixtures and model" || echo "No changes to commit"
          git push
