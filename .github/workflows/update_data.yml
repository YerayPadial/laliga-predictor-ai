name: LaLiga Data Pipeline & Training

# A. Trigger: Cron Schedule
# Se ejecuta una vez al d칤a a las 11:00 UTC (12:00/12:00 de Espa침a)
on:
  schedule:
    - cron: '0 12 * * *'
  # Permite ejecuci칩n manual desde GitHub ("Run workflow")
  workflow_dispatch:

jobs:
  build-and-update:
    runs-on: ubuntu-latest # Entorno Linux est치ndar

    steps:
      # 1. Descargar el c칩digo del repositorio
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Configurar Python 3.10 (Versi칩n estable y moderna)
      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 3. Instalar librer칤as (pandas, scikit-learn, requests, etc.)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      # 4. EJECUTAR PIPELINE DE DATOS
      
      # 4.1. Descargar Hist칩rico (Football-Data 5 a침os)
      # Sustituye al viejo scraper de Flashscore
      - name: 游닌 Download Historical Stats
        run: python src/stats_scraper.py
        
      # 4.2. Descargar Calendario Futuro (API Oficial)
      - name: 游늰 Download Upcoming Fixtures
        run: python src/api_client.py

      # 5. ENTRENAMIENTO DE IA
      # Esto ejecuta feature_eng internamente y genera el modelo .pkl
      - name: 游 Train AI Model
        run: python src/models.py

      # 6. GUARDAR CAMBIOS EN EL REPO
      # Si hay datos nuevos o el modelo ha mejorado, se hace commit
      - name: Commit and Push changes
        run: |
          git config --global user.name "LaLiga AI Bot"
          git config --global user.email "bot@laliga-ai.com"
          # A침adimos la carpeta de datos y modelos
          git add data/
          git commit -m "Auto-update: Match results, fixtures and model 游뱄" || echo "No changes to commit"
          git push